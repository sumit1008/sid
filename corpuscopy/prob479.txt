G2. Permutation Problem (Hard Version)
This is the hard version of the problem. The only difference is that in this version 𝑛≤5⋅105n≤5⋅105 and the sum of 𝑛n for all sets of input data does not exceed 5⋅1055⋅105.
You are given a permutation 𝑝p of length 𝑛n. Calculate the number of index pairs 1≤𝑖<𝑗≤𝑛1≤i<j≤n such that 𝑝𝑖⋅𝑝𝑗pi⋅pj is divisible by 𝑖⋅𝑗i⋅j without remainder.
A permutation is a sequence of 𝑛n integers, in which each integer from 11 to 𝑛n occurs exactly once. For example, [1][1], [3,5,2,1,4][3,5,2,1,4], [1,3,2][1,3,2] are permutations, while [2,3,2][2,3,2], [4,3,1][4,3,1], [0][0] are not.
Tags -brute force
Tags -data structures
Tags -hashing
Tags -math
Tags -number theory
Tags -*2500
